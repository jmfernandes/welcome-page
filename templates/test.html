<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Test Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="http://conversions.herokuapp.com/static/bootstrap.css" rel="stylesheet" type="text/css">
    <link rel="SHORTCUT ICON" href="http://www.conversions.datanab.net/static/img/Dglove.ico">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
        background-image:url('http://www.conversions.datanab.net/static/img/striped_lens.png');
        display: compact;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .fornav {
            position:relative;
            margin-left:-22px;
            margin-right: 20px;
            top:-3px;
            z-index:2;
      }
      footer {
            width:100%;
            position:fixed;
            top: auto;
            bottom: 0;
            background:#6cf;
        }
      .highlight 
        {
            background-color: #00FF00;
        }
        
      .un-highlight
        {
            background-color: #ffffdd;
        }
        .democlass{
        color:red;
        }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
  </head>
  <body>
      <div class="navbar navbar-inverse navbar-fixed-top">
          <div class="navbar-inner">
              <div class="container-fluid">
                  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                  </a>
                  <a class="brand"><img src="http://conversions.herokuapp.com/static/img/Dglove_small_trans3.ico" alt="" style="padding-bottom:5px;" /></a>
                  <a class="brand" style="padding-left:1px;" href="http://www.datanab.net/">Data Nab</a>
                  <div class="nav-collapse">
                      <ul class="nav">
                          <li><a href="http://www.datanab.net/" style="padding-left:5px;"><i class="icon-home icon-white"></i>Home</a></li>
                          <li><a href="http://www.datanab.net/about" style="padding-left:5px;"><i class="icon-info-sign icon-white"></i>About</a></li>
                          <li><a href="http://www.datanab.net/contact" style="padding-left:5px;"><i class="icon-user icon-white"></i>Contact</a></li>
                          <li class="dropdown">
                              <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="1000" data-close-others="true" style="padding-left:4px;"><i class="icon-list-alt icon-white"></i>
                                  Pages <b class="caret"></b>
                              </a>
                              <ul class="dropdown-menu">
                                  <li><a tabindex="-1" href="http://www.constants.datanab.net">Constants</a></li>
                                  <li><a tabindex="-1" href="http://www.conversions.datanab.net">Conversions</a></li>
                                  <li><a tabindex="-1" href="http://www.prices.datanab.net">Prices</a></li>
                                  <li><a tabindex="-1" href="http://www.efficiency.datanab.net">Efficiencies</a></li>
                                  <li class="divider"></li>
                                  <li><a tabindex="-1" href="http://www.datanab.net/examples">Examples</a></li>
                              </ul>
                          </li>
                      </ul>
                      <form method="get" style="margin:2;" action="http://www.picosearch.com/cgi-bin/ts.pl" class="navbar-search pull-right">
                      <input type="hidden" name="index" value="527593" />
                      <input type="text" class="input-medium search-query"  name="query" value="" size="20" placeholder="Type Search Words Here"/>
                      <button type="submit" value="Search" class="btn">Search</button></form>
                  </div><!--/.nav-collapse -->
              </div>
          </div>
      </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span12">
            <div class="page-header">
                <h3 class="offset1">About</h3>
            </div>
          <div class="row-fluid">
            <div id="inputText" class="span6 offset1" ondblclick="mouseDouble()" onmouseup="mouseUp()">Highlight the code here. Any text on this line can be highlighted. Other text on the screen can not be highlighted.
            </div><!--/span-->
            <form>
<select id="myList" onchange="whoo()">
  <option value = "1">Highlight</option>
  <option value = "2">Unhighlight</option>  
</select>
</form>


          </div><!--/row-->
        </div><!--/span-->
      </div><!--/row-->

      <hr>

    </div><!--/.fluid-container-->
    <footer>
          <nav>
              Copyright &copy; Josh Fernandes 2012
          </nav>
    </footer>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script>
    ////// DOM manipulation of dropdown menu
    //$("#myList").attr('size', '2');
    document.getElementById("myList").size=2; //displays both options in drop down
    document.getElementById("myList").selectedIndex = -1; //defaults to none selected

    /////////////Text below hides the dropdown by default

    document.getElementById("myList").disabled = true;
    document.getElementById("myList").style.display = 'none'

    ///// TEST functions for storing selection

////This function is for setting the selection range after the highlight or unhighlight button has been clicked.
function setONLY(el, start, end) {
    if (document.createRange && window.getSelection) {
        var range = document.createRange();
        range.selectNodeContents(el);
        var textNodes = getTextNodesIn(el);
        var foundStart = false;
        var charCount = 0, endCharCount;

        for (var i = 0, textNode; textNode = textNodes[i++]; ) {
            endCharCount = charCount + textNode.length;
            if (!foundStart && start >= charCount && (start < endCharCount || (start == endCharCount && i < textNodes.length))) {
                range.setStart(textNode, start - charCount);
                foundStart = true;
            }
            if (foundStart && end <= endCharCount) {
                range.setEnd(textNode, end - charCount);
                break;
            }
            charCount = endCharCount;
        }

        var sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
    } else if (document.selection && document.body.createTextRange) {
        var textRange = document.body.createTextRange();
        textRange.moveToElementText(el);
        textRange.collapse(true);
        textRange.moveEnd("character", end);
        textRange.moveStart("character", start);
        textRange.select();
    }
}


//this function is for running the setonly function for a certain div
function selectONLY(id, start, end) {
    setONLY(document.getElementById("inputText"), start, end);
}

//////////////
  
    var hereitis;
    var hereitgoes;

    var checkfordouble 
    checkfordouble = 0
    var indexone
    var indextwo

//this function selects an entire highlight if double clicked within the highlight
    function mouseDouble()
    {
      //alert(GetUserSelection()[0])
      //alert(' double clicked')
      //alert( hereitis + '   ' + hereitgoes + '----' + hereitisdup + ' ' + hereitgoesdup)
      checkfordouble = 1
      for (i=0;i<HighlightSet.length;i++){
        if (GetUserSelection()[0] >= HighlightSet[i][0] && GetUserSelection()[0] < HighlightSet[i][1]){
          //window.getSelection().empty();
          selectONLY('inputText',HighlightSet[i][0],HighlightSet[i][1])
          indexone = HighlightSet[i][0]
          indextwo = HighlightSet[i][1]
          //alert(indexone + '  ' + indextwo)
        }
      }
      //alert('hi' + HighlightSet[0])
    }


  //this function makes the drop down menu appear
    function mouseUp()
    {
      //alert(GetUserSelection())
      hereitis = GetUserSelection()[0];
      hereitgoes = GetUserSelection()[1];
      selectONLY('inputText',hereitis,hereitgoes)
      if (hereitis == hereitgoes){
        /////
      }
      else{
      document.getElementById("myList").style.display = 'inline'
      document.getElementById("myList").disabled = false;
    }
    }

    /////////////////////////

//THis function carries out the highlighting
    function whoo()
    {
    if (hereitis == undefined){
      ////
    }
    else{
      if (HighlightSet.length != 0){
        if (indexone == undefined){
          selectONLY('inputText',hereitis,hereitgoes)
        }
        else{
        selectONLY('inputText',indexone,indextwo)
        //alert(indexone + 'INDEXONE')
        indexone = undefined;
        indextwo = undefined;
        //alert(indexone + ' INDEXONE')
      }
    if (document.getElementById("myList").selectedIndex == 0){
        selectAndHighlightRange('inputText', GetUserSelection()[0], GetUserSelection()[1])
      }
      else{
        selectAndUnhighlightRange('inputText', GetUserSelection()[0], GetUserSelection()[1])
      } 
      
      }
      else{
      selectONLY('inputText',hereitis,hereitgoes)
    
      if (document.getElementById("myList").selectedIndex == 0){
        selectAndHighlightRange('inputText', GetUserSelection()[0], GetUserSelection()[1])
      }
      else{
        selectAndUnhighlightRange('inputText', GetUserSelection()[0], GetUserSelection()[1])
      } 
      }  
    }
    document.getElementById("myList").selectedIndex = -1; ///deselects what is selected in dropdown
    document.getElementById("myList").disabled = true;
    document.getElementById("myList").style.display = 'none'
    
    }
        function runScript(e) {
            if (e.keyCode == 13) {
                alert("Hello! you pushed enter");
                return false;
            }
        }
    </script>
    <script src="http://www.conversions.datanab.net/static/js/jquery.js"></script>
    <script src="http://www.conversions.datanab.net/static/js/bootstrap.js"></script>
    <script src="http://www.conversions.datanab.net/static/js/bootstrap.min.js"></script>
      <script src="http://conversions.herokuapp.com/static/js/bootstrap-dropdown.js"></script>
      <script type="text/javascript">
          $(document).ready(function () {
                            $('.dropdown-toggle').dropdown();
                            });
      var check = ''

          var selit;
          

          function GetUserSelection() {
            if (window.getSelection) {
              selit = window.getSelection();
                if (selit.rangeCount) {
                  range = selit.getRangeAt(0)
                  //var referenceNode = document.getElementsByTagName("div").item(0);
                  //startNode = document.getElementById("inputText");
                  //range.setStartBefore(referenceNode);
                  //startOffset = 0;
                  //range.setStart(startNode,startOffset);
                  //alert(selit.getRangeAt(0).startOffset + '  range count')
                  return [range.startOffset, range.endOffset];
                }
              } else if (document.selection) {
                  return document.selection.createRange();
              }
                  return null;
          }


          
          function getTextNodesIn(node) {
              var textNodes = [];
              if (node.nodeType == 3) {
                  textNodes.push(node);
              } else {
                  var children = node.childNodes;
                  for (var i = 0, len = children.length; i < len; ++i) {
                      textNodes.push.apply(textNodes, getTextNodesIn(children[i]));
                  }
              }
              return textNodes;
          }
          
          function setSelectionRange(el, start, end) {
              if (document.createRange && window.getSelection) {
                  var range = document.createRange();
                  range.selectNodeContents(el);
                  var textNodes = getTextNodesIn(el);
                  var foundStart = false;
                  var charCount = 0, endCharCount;
                  
                  for (var i = 0, textNode; textNode = textNodes[i++]; ) {
                      endCharCount = charCount + textNode.length;
                      if (!foundStart && start >= charCount && (start < endCharCount || (start == endCharCount && i < textNodes.length))) {
                          range.setStart(textNode, start - charCount);
                          foundStart = true;
                      }
                      if (foundStart && end <= endCharCount) {
                          range.setEnd(textNode, end - charCount);
                          break;
                      }
                      charCount = endCharCount;
                  }
                  
                  var sel = window.getSelection();
                  sel.removeAllRanges();
                  sel.addRange(range);
              } else if (document.selection && document.body.createTextRange) {
                  var textRange = document.body.createTextRange();
                  textRange.moveToElementText(el);
                  textRange.collapse(true);
                  textRange.moveEnd("character", end);
                  textRange.moveStart("character", start);
                  textRange.select();
              }
          }
          
          function makeEditableAndHighlight(color) {
              sel = selit;
              if (sel.rangeCount && sel.getRangeAt) {
                  range = sel.getRangeAt(0);
                  //alert(sel.rangeCount + '   range')
              }
              document.designMode = "on"; //this is the part that breaks the range selection
              if (range) {
                  sel.removeAllRanges();
                  sel.addRange(range);
              }
              // Use HiliteColor since some browsers apply BackColor to the whole block
              if (!document.execCommand("HiliteColor", false, color)) {
                  document.execCommand("BackColor", false, color);
              }
              document.designMode = "off"; //design mode turns off here
          }
          
          function highlight(color) {
              var range, sel;
              if (window.getSelection) {
                  // IE9 and non-IE
                  try {
                      if (!document.execCommand("BackColor", false, color)) {
                          makeEditableAndHighlight(color);
                      }
                  } catch (ex) {
                      makeEditableAndHighlight(color)
                  }
              } else if (document.selection && document.selection.createRange) {
                  // IE <= 8 case
                  range = document.selection.createRange();
                  range.execCommand("BackColor", false, color);
              }
          }
          
          function selectOnly(id, start, end) {
              
              setSelectionRange(document.getElementById("inputText"), start, end);
          }
          function selectAndHighlightRange(id, start, end) {
              
              //setSelectionRange(document.getElementById("inputText"), start, end);
              //highlight("yellow");
              ChangeStoreData();
              //window.getSelection().empty();
              //GetUserSelection()
              stylizeHighlightedString();
              //highlight("yellow");
              //window.getSelection().removeAllRanges();
              //GetUserSelection()
              //ChangeStoreData(); // this has to go before highlight to work
              
              //myFunction3333()
              //window.getSelection().removeAllRanges();
              window.getSelection().empty();
          }

          function myFunction3333() //doesn't work
{ 
var h1=window.getSelection();
var att=document.createAttribute("class");
att.value="democlass";
h1.setAttributeNode(att); //Error: event.returnValue is deprecated. Please use the standard event.preventDefault() instead.
alert(att.nodeValue)
}

          function selectAndUnhighlightRange(id, start, end) {
              //setSelectionRange(document.getElementById("inputText"), start, end);
              ReduceStoreData();
              //highlight("white");
              window.getSelection().removeAllRanges();
          }

          /////////////// initialize only on first session
          //var RangeSet = new Array(3,6)  //this line not needed later
          //var Stuff = new Array (12,15)  //this line not needed later
          //var HighlightSet = new Array(RangeSet,Stuff)  //this line should be changed to var HighlightSet = new Array()
          var CheckEndList = []  //this is needed
          var CheckStartList = []  //this is needed
          //var HighlightSetAdjusted = [] //not used anymore
          var HighlightSet = new Array()

          ///////////////// THIS IS THE CODE FOR MAKING THE LIST OF HIGHLIGHTS

          function ChangeStoreData() {
          var CompareRange = new Array(GetUserSelection()[0],GetUserSelection()[1]) //this line will be the range from selection later
          //alert(CompareRange + ' Compare range')
          var unique = 1
          HighlightSet.push(CompareRange)
          if (HighlightSet.length == 1){
            null          }
          else {
          for (i=0;i<(HighlightSet.length - 1);i++)
          {
            if (CompareRange[0] <= HighlightSet[i][0] && CompareRange[1] >= HighlightSet[i][1]) {
              HighlightSet[i] = CompareRange
              unique = 0
            }
            if (CompareRange[0] <= HighlightSet[i][0] && CompareRange[1] < HighlightSet[i][1] && CompareRange[1] >= HighlightSet[i][0]) {
              HighlightSet[i][0] = CompareRange[0]
              unique = 0
            }
            if (CompareRange[0] > HighlightSet[i][0] && CompareRange[1] >= HighlightSet[i][1] && CompareRange[0] <= HighlightSet[i][1]) {
              HighlightSet[i][1] = CompareRange[1]
              unique = 0
            }
            // else {
            //   if (check == 1){ 
            //   alert("hi" + check)
            //   //HighlightSet.push(CompareRange)
            //   }
            //   else {
            //     check = 0
            //   }
            // }
            CheckEndList.push([i,HighlightSet[i][1]])
            CheckStartList.push([i,HighlightSet[i][0]])
          }
          if (unique == 0) {
            HighlightSet.pop(HighlightSet.length)
            //alert('not unique')
            //CheckEndList.push([3,5])
            //CheckStartList.push([3,5])
          }
          else if (unique == 1){
              CheckEndList.push([HighlightSet.length-1,HighlightSet[HighlightSet.length-1][1]])
              CheckStartList.push([HighlightSet.length-1,HighlightSet[HighlightSet.length-1][0]])
          }
          // for (i=0;i<(HighlightSet.length);i++) {
          // HighlightSetAdjusted[i] = HighlightSet[i] 
          // }
          alert(HighlightSet.length + ' the stuff is ' + HighlightSet)
          for (i=0;i<CheckEndList.length;i++){
            for (j=0;j<CheckStartList.length;j++){
              if (i == j) {
                null
              }
              else if (i != j && CheckEndList[i][1] > CheckStartList[j][1] && CheckStartList[i][1] < CheckStartList[j][1] ){
                //HighlightSet[i][0] = CheckStartList[i][1]
                //alert(CheckEndList[i][1] + ' ' + CheckEndList[j][1])
                if (CheckEndList[i][1] < CheckEndList[j][1]){
                  HighlightSet[i][1] = CheckEndList[j][1]
                }
                if (CheckEndList[i][1] > CheckEndList[j][1]){
                  HighlightSet[i][1] = CheckEndList[i][1]
                }

                HighlightSet.splice(j,1)
                //alert(HighlightSet[j])
                //alert(CheckEndList[i][1] + '>' + CheckStartList[j][1] + ' ' + CheckStartList[i][1] + '<' + CheckStartList[j][1])
              }
              else if (i < j && CheckEndList[i][1] > CheckStartList[j][1] && CheckStartList[i][1] == CheckStartList[j][1] ){
                //HighlightSet[i][0] = CheckStartList[i][1]
                //alert(CheckEndList[i][1] + ' ' + CheckEndList[j][1])
                if (CheckEndList[i][1] < CheckEndList[j][1]){
                  HighlightSet[i][1] = CheckEndList[j][1]
                  //alert('small')
                }
                if (CheckEndList[i][1] > CheckEndList[j][1]){
                  HighlightSet[i][1] = CheckEndList[i][1]
                }
                //alert(HighlightSet[j] + 'this is the end')
                HighlightSet.splice(j,1)
                //alert(HighlightSet[j])
                //alert(CheckEndList[i][1] + '>' + CheckStartList[j][1] + ' ' + CheckStartList[i][1] + '<' + CheckStartList[j][1])
              }
              // else if (i != j && CheckStartList[i][1] > CheckStartList[j][1] && CheckEndList[i][1] < CheckEndList[j][1]){
              //   //HighlightSet[i][0] = CheckStartList[i][1]
              //   //HighlightSet[i][1] = CheckEndList[j][1]
              //   //HighlightSet.splice(j,1)
              //   //alert(HighlightSet[j])
              //   alert("WHATWHAT")
              // }
            }
          }

          }
            //alert(CheckStartList + 'start')
            CheckEndList.length = 0;
            CheckStartList.length = 0;
            alert(HighlightSet + 'unique is' + unique)
           //maybe I can add highlight functionality at the end 
          }

          function ReduceStoreData() {
          alert(HighlightSet + ' before')
          var CompareRange = new Array(GetUserSelection()[0],GetUserSelection()[1]) //this line will be the range from selection later
          //var unique = 1
          //HighlightSet.push(CompareRange)
          //alert(CompareRange + ' compare range')
          if (HighlightSet.length == 0){
            null          }
          else {
          for (i=0;i<(HighlightSet.length);i++)
          {
            if (CompareRange[0] <= HighlightSet[i][0] && CompareRange[1] >= HighlightSet[i][1]) {
              HighlightSet[i] = 'delete'
              //break;
              //unique = 0
            }
            if (CompareRange[0] <= HighlightSet[i][0] && CompareRange[1] < HighlightSet[i][1] && CompareRange[1] >= HighlightSet[i][0]) {
              HighlightSet[i][0] = CompareRange[1]
              //unique = 0
            }
            if (CompareRange[0] > HighlightSet[i][0] && CompareRange[1] >= HighlightSet[i][1] && CompareRange[0] <= HighlightSet[i][1]) {
              HighlightSet[i][1] = CompareRange[0]
              //unique = 0
            }
            if (CompareRange[0] > HighlightSet[i][0] && CompareRange[1] < HighlightSet[i][1]){
              Points = [HighlightSet[i][0],CompareRange[0],CompareRange[1],HighlightSet[i][1]]
              HighlightSet[i][1] = CompareRange[0]
              HighlightSet.push([Points[2],Points[3]])
              break;
            }
          }
          //alert(HighlightSet + '   ' + HighlightSet.indexOf('-1,-1') + '   i love it')
          function contains(a, obj) {
            var i = a.length;
            while (i--) {
              if (a[i] === obj) {
                return true;
              }
            }
            return false;
          }
        
          Array.prototype.contains = function(obj) {
            var i = this.length;
            while (i--) {
              if (this[i] === obj) {
                return true;
              }
            }
            return false;
          }


          while (HighlightSet.contains('delete')){
            HighlightSet.splice(HighlightSet.indexOf('delete'),1)
          }
  
          
        }
          alert(HighlightSet + ' after')
        }
          


function stylizeHighlightedString() 
{

  //alert(text.focusOffset - text.anchorOffset);

  var text = window.getSelection();
  alert(window.getSelection())
  //alert (text.anchorOffset)
  var start = text.anchorOffset;
  //cheese = getTextNodesIn(inputText)
  //alert(cheese + '  cheese')
  //alert(start);

  var end = text.focusOffset - text.anchorOffset;
  //alert(end);

  range = window.getSelection().getRangeAt(0);
  //alert(range)
  range1 = window.getSelection().toString();
  var selectionContents = range.extractContents();
  var span = document.createElement("span");

  span.appendChild(selectionContents); //ExtractContents breaks the true range

  span.setAttribute("class"); 
  span.style.backgroundColor = "yellow";
  span.style.color = "black";

  range.insertNode(span);
}

//////////////////////////////////////////////////////


          
</script>
<!-- <button onclick="stylizeHighlightedString() ">HIGHLIGHT IT</button> -->
<button onclick="selectAndHighlightRange('inputText', GetUserSelection()[0], GetUserSelection()[1])">Highlight</button>
<!-- <button onclick="selectAndUnhighlightRange('inputText', GetUserSelection()[0], GetUserSelection()[1])">Unhighlight</button> -->
<!-- <button onclick="PrintStoreData()">Range Data</button> -->
<!-- <button onclick="ChangeStoreData()">Change Data</button> --> 
<!-- <button onclick="whoo()">get range</button> -->
<!-- <button onclick="imtrying(document.getElementById('inputText'),getSelectionHtml(),'highlight');">another</button>
<a href="javascript:void(0);" onclick="highlightSelection();">Highlight</a> 
    &nbsp;&nbsp;|&nbsp;&nbsp;
    <a href="javascript:void(0);" onclick="RemovehighlightSelection();">Remove Highlight</a>
-->
      </script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
    <script type="text/javascript">try{ clicky.init(100642142); }catch(e){}</script>
  </body>
</html>