<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Test Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="http://conversions.herokuapp.com/static/bootstrap.css" rel="stylesheet" type="text/css">
    <link rel="SHORTCUT ICON" href="http://www.conversions.datanab.net/static/img/Dglove.ico">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
        background-image:url('http://www.conversions.datanab.net/static/img/striped_lens.png');
        display: compact;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .fornav {
            position:relative;
            margin-left:-22px;
            margin-right: 20px;
            top:-3px;
            z-index:2;
      }
      footer {
            width:100%;
            position:fixed;
            top: auto;
            bottom: 0;
            background:#6cf;
        }
      .highlight 
        {
            background-color: #00FF00;
        }
        
      .un-highlight
        {
            background-color: #ffffdd;
        }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
  </head>
  <body>
      <div class="navbar navbar-inverse navbar-fixed-top">
          <div class="navbar-inner">
              <div class="container-fluid">
                  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                  </a>
                  <a class="brand"><img src="http://conversions.herokuapp.com/static/img/Dglove_small_trans3.ico" alt="" style="padding-bottom:5px;" /></a>
                  <a class="brand" style="padding-left:1px;" href="http://www.datanab.net/">Data Nab</a>
                  <div class="nav-collapse">
                      <ul class="nav">
                          <li><a href="http://www.datanab.net/" style="padding-left:5px;"><i class="icon-home icon-white"></i>Home</a></li>
                          <li><a href="http://www.datanab.net/about" style="padding-left:5px;"><i class="icon-info-sign icon-white"></i>About</a></li>
                          <li><a href="http://www.datanab.net/contact" style="padding-left:5px;"><i class="icon-user icon-white"></i>Contact</a></li>
                          <li class="dropdown">
                              <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="1000" data-close-others="true" style="padding-left:4px;"><i class="icon-list-alt icon-white"></i>
                                  Pages <b class="caret"></b>
                              </a>
                              <ul class="dropdown-menu">
                                  <li><a tabindex="-1" href="http://www.constants.datanab.net">Constants</a></li>
                                  <li><a tabindex="-1" href="http://www.conversions.datanab.net">Conversions</a></li>
                                  <li><a tabindex="-1" href="http://www.prices.datanab.net">Prices</a></li>
                                  <li><a tabindex="-1" href="http://www.efficiency.datanab.net">Efficiencies</a></li>
                                  <li class="divider"></li>
                                  <li><a tabindex="-1" href="http://www.datanab.net/examples">Examples</a></li>
                              </ul>
                          </li>
                      </ul>
                      <form method="get" style="margin:2;" action="http://www.picosearch.com/cgi-bin/ts.pl" class="navbar-search pull-right">
                      <input type="hidden" name="index" value="527593" />
                      <input type="text" class="input-medium search-query"  name="query" value="" size="20" placeholder="Type Search Words Here"/>
                      <button type="submit" value="Search" class="btn">Search</button></form>
                  </div><!--/.nav-collapse -->
              </div>
          </div>
      </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span12">
            <div class="page-header">
                <h3 class="offset1">About</h3>
            </div>
          <div class="row-fluid">
            <div id="inputText" class="span6 offset1">Highlight the code here. Any text on this line can be highlighted. Other text on the screen can not be highlighted.
            </div><!--/span-->
          </div><!--/row-->
        </div><!--/span-->
      </div><!--/row-->

      <hr>

    </div><!--/.fluid-container-->
    <footer>
          <nav>
              Copyright &copy; Josh Fernandes 2012
          </nav>
    </footer>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script>
        function runScript(e) {
            if (e.keyCode == 13) {
                alert("Hello! you pushed enter");
                return false;
            }
        }
    </script>
    <script src="http://www.conversions.datanab.net/static/js/jquery.js"></script>
    <script src="http://www.conversions.datanab.net/static/js/bootstrap.js"></script>
    <script src="http://www.conversions.datanab.net/static/js/bootstrap.min.js"></script>
      <script src="http://conversions.herokuapp.com/static/js/bootstrap-dropdown.js"></script>
      <script type="text/javascript">
          $(document).ready(function () {
                            $('.dropdown-toggle').dropdown();
                            });
      var check = ''
//       function highlight(text)
// {
//     var selected_text = getSelectionHtml()
//     inputText = document.getElementById("inputText")
//     var innerHTML = inputText.innerHTML
//     var index = innerHTML.indexOf(text);
//     var color = "#ff0000";
//     var selected = getSelectionHtml();
//     //alert(selected)
//     if(selected_text.length == 0){
//       return;
//     }
//     else if (check.length > 0){
//     alert("not empty")
//     innerHTML = innerHTML.replace("<span style='background-color:#ff0000;'>",'');
//     innerHTML = innerHTML.replace('<span style="background-color:#ff0000;">','');
//     innerHTML = innerHTML.replace('</span>','');
//     innerHTML = innerHTML.replace('</span> ',' ');
//     innerHTML = innerHTML.replace("<span style='background-color:white;'>",'');
//     innerHTML = innerHTML.replace('<span style="background-color:white;">','');
//     }
//     //im close
//     //innerHTML = innerHTML.replace('<span style="background-color:#ff0000;">','');
//     //innerHTML = innerHTML.replace('</span>','');
//     //innerHTML = innerHTML.replace('</span> ',' ');
//     //innerHTML = innerHTML.replace('<span style="background-color:white;">','');
//     if ( index >= 0 )
//     { 
//         innerHTML = innerHTML.substring(0,index) + "<span style='background-color:" + color + ";'>" + innerHTML.substring(index,index+text.length) + "</span>" + innerHTML.substring(index + text.length);
//         inputText.innerHTML = innerHTML 
//     }
//     //alert(innerHTML)
//     //alert(innerHTML)
// }
//       function unhighlightall(text)
// {
//     inputText = document.getElementById("inputText")
//     var innerHTML = inputText.innerHTML
//     var index = innerHTML.indexOf(text);
//     var color = "#ff0000";
//     var black = "#000000";
//     var revert = "white";
//     var i = 0;
//     while (i<10)
//     {
//     innerHTML = innerHTML.replace("<span style='background-color:#ff0000;'>",'');
//     innerHTML = innerHTML.replace('<span style="background-color:#ff0000;">','');
//     innerHTML = innerHTML.replace(' <span style="background-color:#ff0000;">',' ');
//     innerHTML = innerHTML.replace('</span>','');
//     innerHTML = innerHTML.replace('</span> ',' ');
//     innerHTML = innerHTML.replace(' </span>',' ');
//     innerHTML = innerHTML.replace("<span style='background-color:white;'>",'');
//     innerHTML = innerHTML.replace('<span style="background-color:white;">','');
//     innerHTML = innerHTML.replace(' <span style="background-color:#ff0000;">',' ');
//     i++
//     }
//     //alert(innerHTML)
//     if ( index >= 0 )
//     { 
//         innerHTML = innerHTML.substring(0,index) + "<span style='background-color:" + "white" + ";'>" + innerHTML.substring(index,index+text.length) + "</span>" + innerHTML.substring(index + text.length);
//         inputText.innerHTML = innerHTML 
//     }

// }
// function highlightSelection() {
      
//             var selection;

//             //Get the selected stuff
//             if (window.getSelection)
//                 selection = window.getSelection();
//             else if (typeof document.selection != "undefined")
//                 selection = document.selection;

//             //Get a the selected content, in a range object
//             var range = selection.getRangeAt(0);

//             //If the range spans some text, and inside a tag, set its css class.
//             if (range && !selection.isCollapsed) {
//                 if (selection.anchorNode.parentNode == selection.focusNode.parentNode) {
//                     var span = document.createElement('span');
//                     span.className = 'highlight';
//                     range.surroundContents(span);
//                 }
//             }
//         }
// function RemovehighlightSelection() {
//             var selection;

//             //Get the selected stuff
//             if (window.getSelection)
//                 selection = window.getSelection();
//             else if (typeof document.selection != "undefined")
//                 selection = document.selection;

//             //Get a the selected content, in a range object
//             var range = selection.getRangeAt(0);

//             //If the range spans some text, and inside a tag, set its css class.
//             if (range && !selection.isCollapsed) {
//                 if (selection.anchorNode.parentNode == selection.focusNode.parentNode) {
//                     var span = document.createElement('span');
//                     span.className = 'un-highlight';
//                     range.surroundContents(span);
//                 }
//             }
//         }
// //var ham = window.getSelection();
// //var cheese = ham.toString()
// //var milk = typeof ham
// //var soda = typeof cheese
// //var eggs = 'fox'
// //var selRange = ham.getRangeAt(0);
// function getSelectionHtml() {
//     var html = "";
//     if (typeof window.getSelection != "undefined") {
//         var sel = window.getSelection();
//         if (sel.rangeCount) {
//             var container = document.createElement("div");
//             for (var i = 0, len = sel.rangeCount; i < len; ++i) {
//                 container.appendChild(sel.getRangeAt(i).cloneContents());
//             }
//             html = container.innerHTML;
//         }
//     } else if (typeof document.selection != "undefined") {
//         if (document.selection.type == "Text") {
//             html = document.selection.createRange().htmlText;
//         }
//     }
//     //might need the below code
//     //html = html.replace('<span style="background-color:#ff0000;">','');
//     //html = html.replace('</span>','');
//     //html = html.replace('</span> ',' ');
//     //html = html.replace('<span style="background-color:white;">','');
//     return html;
// }
          

// function imtrying(container,what,spanClass) {
//     var content = container.innerHTML,
//         pattern = new RegExp('(>[^<.]*)(' + what + ')([^<.]*)','g'),
//         replaceWith = '$1<span ' + ( spanClass ? 'class="' + spanClass + '"' : '' ) + '">$2</span>$3',
//         highlighted = content.replace(pattern,replaceWith);
//     return (container.innerHTML = highlighted) !== content;
// }
          
          
          
          
          
// ////////////////////////////////////////////////////
//     //method 1 for getting range of text
    
//           function getTextSelection(el) {
//               var start = 0, end = 0, normalizedValue, range,
//               textInputRange, len, endRange;
              
//               if (typeof el.selectionStart == "number" && typeof el.selectionEnd == "number") {
//                   start = el.selectionStart;
//                   end = el.selectionEnd;
//               } else {
//                   range = document.selection.createRange();
                  
//                   if (range && range.parentElement() == el) {
//                       len = el.value.length;
//                       normalizedValue = el.value.replace(/\r\n/g, "\n");
                      
//                       // Create a working TextRange that lives only in the input
//                       textInputRange = el.createTextRange();
//                       textInputRange.moveToBookmark(range.getBookmark());
                      
//                       // Check if the start and end of the selection are at the very end
//                       // of the input, since moveStart/moveEnd doesn't return what we want
//                       // in those cases
//                       endRange = el.createTextRange();
//                       endRange.collapse(false);
                      
//                       if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
//                           start = end = len;
//                       } else {
//                           start = -textInputRange.moveStart("character", -len);
//                           start += normalizedValue.slice(0, start).split("\n").length - 1;
                          
//                           if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
//                               end = len;
//                           } else {
//                               end = -textInputRange.moveEnd("character", -len);
//                               end += normalizedValue.slice(0, end).split("\n").length - 1;
//                           }
//                       }
//                   }
//               }
//               alert("start :" + start + " End :" + end);
//           }
          
// /////////////////////////////////////////////////////////////////////////
//           //method 2 for getting range of text
          
//           function getInputSelection(el) {
//               var start = 0, end = 0, normalizedValue, range,
//               textInputRange, len, endRange;
              
//               if (typeof el.selectionStart == "number" && typeof el.selectionEnd == "number") {
//                   start = el.selectionStart;
//                   end = el.selectionEnd;
//               } else {
//                   range = document.selection.createRange();
                  
//                   if (range && range.parentElement() == el) {
//                       len = el.value.length;
//                       normalizedValue = el.value.replace(/\r\n/g, "\n");
                      
//                       // Create a working TextRange that lives only in the input
//                       textInputRange = el.createTextRange();
//                       textInputRange.moveToBookmark(range.getBookmark());
                      
//                       // Check if the start and end of the selection are at the very end
//                       // of the input, since moveStart/moveEnd doesn't return what we want
//                       // in those cases
//                       endRange = el.createTextRange();
//                       endRange.collapse(false);
                      
//                       if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
//                           start = end = len;
//                       } else {
//                           start = -textInputRange.moveStart("character", -len);
//                           start += normalizedValue.slice(0, start).split("\n").length - 1;
                          
//                           if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
//                               end = len;
//                           } else {
//                               end = -textInputRange.moveEnd("character", -len);
//                               end += normalizedValue.slice(0, end).split("\n").length - 1;
//                           }
//                       }
//                   }
//               }
              
//               return {
//                   start: start,
//                   end: end
//               };
//           }
          
////////////////////////////////////////////////////////////////////

          function GetUserSelection() {
          var sel;
            if (window.getSelection) {
              sel = window.getSelection();
                if (sel.rangeCount) {
                  return [sel.getRangeAt(0).startOffset, sel.getRangeAt(0).endOffset];
                }
              } else if (document.selection) {
                  return document.selection.createRange();
              }
                  return null;
          }

          //function foo() {
          //    var selObj = window.getSelection();
          //    var startRange = selObj.getRangeAt(0).startOffset;
          //    var endRange = selObj.getRangeAt(0).endOffset;
              // do stuff with the range
          //    return [startRange, endRange];
          //}

          //function PrintRange()
          //{
          //alert(foo())
          //}
          
          function getTextNodesIn(node) {
              var textNodes = [];
              if (node.nodeType == 3) {
                  textNodes.push(node);
              } else {
                  var children = node.childNodes;
                  for (var i = 0, len = children.length; i < len; ++i) {
                      textNodes.push.apply(textNodes, getTextNodesIn(children[i]));
                  }
              }
              return textNodes;
          }
          
          function setSelectionRange(el, start, end) {
              if (document.createRange && window.getSelection) {
                  var range = document.createRange();
                  range.selectNodeContents(el);
                  var textNodes = getTextNodesIn(el);
                  var foundStart = false;
                  var charCount = 0, endCharCount;
                  
                  for (var i = 0, textNode; textNode = textNodes[i++]; ) {
                      endCharCount = charCount + textNode.length;
                      if (!foundStart && start >= charCount && (start < endCharCount || (start == endCharCount && i < textNodes.length))) {
                          range.setStart(textNode, start - charCount);
                          foundStart = true;
                      }
                      if (foundStart && end <= endCharCount) {
                          range.setEnd(textNode, end - charCount);
                          break;
                      }
                      charCount = endCharCount;
                  }
                  
                  //var sel = window.getSelection();
                  //sel.removeAllRanges();
                  //sel.addRange(range);
              } else if (document.selection && document.body.createTextRange) {
                  var textRange = document.body.createTextRange();
                  textRange.moveToElementText(el);
                  textRange.collapse(true);
                  textRange.moveEnd("character", end);
                  textRange.moveStart("character", start);
                  textRange.select();
              }
          }
          
          function makeEditableAndHighlight(colour) {
              sel = window.getSelection();
              if (sel.rangeCount && sel.getRangeAt) {
                  range = sel.getRangeAt(0);
              }
              document.designMode = "on";
              if (range) {
                  sel.removeAllRanges();
                  sel.addRange(range);
              }
              // Use HiliteColor since some browsers apply BackColor to the whole block
              if (!document.execCommand("HiliteColor", false, colour)) {
                  document.execCommand("BackColor", false, colour);
              }
              document.designMode = "off";
          }
          
          function highlight(colour) {
              var range, sel;
              if (window.getSelection) {
                  // IE9 and non-IE
                  try {
                      if (!document.execCommand("BackColor", false, colour)) {
                          makeEditableAndHighlight(colour);
                      }
                  } catch (ex) {
                      makeEditableAndHighlight(colour)
                  }
              } else if (document.selection && document.selection.createRange) {
                  // IE <= 8 case
                  range = document.selection.createRange();
                  range.execCommand("BackColor", false, colour);
              }
          }
          
          function selectAndHighlightRange(id, start, end) {
              setSelectionRange(document.getElementById("inputText"), start, end);
              highlight("yellow");
              window.getSelection().removeAllRanges();
          }

          function selectAndUnhighlightRange(id, start, end) {
              setSelectionRange(document.getElementById("inputText"), start, end);
              highlight("white");
              window.getSelection().removeAllRanges();
          }

          /////////////// initialize only on first session
          var RangeSet = new Array(3,6)  //this line not needed later
          var Stuff = new Array (12,15)  //this line not needed later
          var HighlightSet = new Array(RangeSet,Stuff)  //this line should be changed to var HighlightSet = new Array()
          var CheckEndList = []  //this is needed
          var CheckStartList = []  //this is needed
          var HighlightSetAdjusted = [] //this is needed

          /////////////////

          function ChangeStoreData() {
          var CompareRange = new Array(6,12) //this line will be the range from selection later
          var unique = 1
          HighlightSet.push(CompareRange)
          if (HighlightSet.length == 1){
            null          }
          else {
          for (i=0;i<(HighlightSet.length - 1);i++)
          {
            if (CompareRange[0] <= HighlightSet[i][0] && CompareRange[1] >= HighlightSet[i][1]) {
              HighlightSet[i] = CompareRange
              unique = 0
            }
            if (CompareRange[0] <= HighlightSet[i][0] && CompareRange[1] < HighlightSet[i][1] && CompareRange[1] >= HighlightSet[i][0]) {
              HighlightSet[i][0] = CompareRange[0]
              unique = 0
            }
            if (CompareRange[0] > HighlightSet[i][0] && CompareRange[1] >= HighlightSet[i][1] && CompareRange[0] <= HighlightSet[i][1]) {
              HighlightSet[i][1] = CompareRange[1]
              unique = 0
            }
            // else {
            //   if (check == 1){ 
            //   alert("hi" + check)
            //   //HighlightSet.push(CompareRange)
            //   }
            //   else {
            //     check = 0
            //   }
            // }
            CheckEndList.push([i,HighlightSet[i][1]])
            CheckStartList.push([i,HighlightSet[i][0]])
          }
          if (unique == 0) {
            HighlightSet.pop(HighlightSet.length)
            //alert('not unique')
            //CheckEndList.push([3,5])
            //CheckStartList.push([3,5])
          }
          else if (unique == 1){
              CheckEndList.push([HighlightSet.length-1,HighlightSet[HighlightSet.length-1][1]])
              CheckStartList.push([HighlightSet.length-1,HighlightSet[HighlightSet.length-1][0]])
          }
          // for (i=0;i<(HighlightSet.length);i++) {
          // HighlightSetAdjusted[i] = HighlightSet[i] 
          // }
          alert(HighlightSet.length + ' the stuff is ' + HighlightSet)
          for (i=0;i<CheckEndList.length;i++){
            for (j=0;j<CheckStartList.length;j++){
              if (i == j) {
                null
              }
              else if (i != j && CheckEndList[i][1] > CheckStartList[j][1] && CheckStartList[i][1] < CheckStartList[j][1] ){
                //HighlightSet[i][0] = CheckStartList[i][1]
                alert(CheckEndList[i][1] + ' ' + CheckEndList[j][1])
                if (CheckEndList[i][1] < CheckEndList[j][1]){
                  HighlightSet[i][1] = CheckEndList[j][1]
                }
                if (CheckEndList[i][1] > CheckEndList[j][1]){
                  HighlightSet[i][1] = CheckEndList[i][1]
                }

                HighlightSet.splice(j,1)
                //alert(HighlightSet[j])
                //alert(CheckEndList[i][1] + '>' + CheckStartList[j][1] + ' ' + CheckStartList[i][1] + '<' + CheckStartList[j][1])
              }
              else if (i != j && CheckStartList[i][1] > CheckStartList[j][1] && CheckEndList[i][1] < CheckEndList[j][1]){
                //HighlightSet[i][0] = CheckStartList[i][1]
                //HighlightSet[i][1] = CheckEndList[j][1]
                //HighlightSet.splice(j,1)
                //alert(HighlightSet[j])
                alert("WHATWHAT")
              }
            }
          }

          }
            //alert(CheckStartList + 'start')
            CheckEndList.length = 0;
            CheckStartList.length = 0;
            alert(HighlightSet + 'unique is' + unique)
            
          }

          function PrintStoreData() {
            alert(HighlightSet)
          }
          
          
</script>
<button onclick="selectAndHighlightRange('inputText', GetUserSelection()[0], GetUserSelection()[1])">Highlight</button>
<button onclick="selectAndUnhighlightRange('inputText', GetUserSelection()[0], GetUserSelection()[1])">Unhighlight</button>
<button onclick="PrintStoreData()">Range Data</button>
<button onclick="ChangeStoreData()">Change Data</button>
<!-- <button onclick="whoo()">get range</button> -->
<!-- <button onclick="imtrying(document.getElementById('inputText'),getSelectionHtml(),'highlight');">another</button>
<a href="javascript:void(0);" onclick="highlightSelection();">Highlight</a> 
    &nbsp;&nbsp;|&nbsp;&nbsp;
    <a href="javascript:void(0);" onclick="RemovehighlightSelection();">Remove Highlight</a>
-->
      </script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
    <script type="text/javascript">try{ clicky.init(100642142); }catch(e){}</script>
  </body>
</html>